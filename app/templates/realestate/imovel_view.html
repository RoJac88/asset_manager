{% extends "base.html" %}

{% block scripts %}
  {{ super() }}
  <script type="text/javascript" src="{{ url_for('static', filename='js/imovel_view.js') }}"></script>
{% endblock %}

{% block app_content %}
{% if imovel != None %}
<div class="container">
  <div class="row">
    <div class="col-xs-5">
      <div class="panel panel-default">
      	<div class="panel-heading text-center panel-headstyle"><h4>Real Estate Info</h4></div>
      	<div class="panel-body">
      		<p><strong>{{ imovel.name }}</strong></p>
          <p>{{ imovel.addr_rua }}, {{ imovel.addr_num }} - {{ imovel.addr_compl }}</p>
          <p>{{ imovel.addr_bairro }}</p>
          <p>{{ imovel.addr_cidade }} - {{ imovel.addr_uf }}</p>
          <p>{{ imovel.addr_cep[:-3] }}-{{ imovel.addr_cep[-3:] }}</p>
        </div>
        {% if current_user.is_authenticated %}
        <div class="panel-footer">
          <button type="button" class="btn btn-warning btn-xs" data-toggle="modal" data-target="#edit_contact"><span class="glyphicon glyphicon-pencil"></span> Edit</button>
        </div>
        {% endif %}
      </div>
    </div>
    <div class="col-xs-7">
      <p>Mapa</p>
    </div>
  </div>
  <div class="row">
    <div class="panel panel-default">
      <div class="panel-heading text-center panel-headstyle"><h4>Owners</h4></div>
      <div class="panel-body">
        <div class="col-xs-7">
          <table id="owners" class="table table-striped table-hover table-condensed">
        		<thead>
        			<tr>
        				<th>CPF / CNPJ</th>
        				<th>Name</th>
        				<th>Shares</th>
        			</tr>
        		</thead>
        		<tbody>
        		{% for owner in owners %}
        		{% include 'realestate/_owner.html' %}
        		{% endfor %}
        		</tbody>
            {% if unknown_shares > 0 %}
            <tfoot>
              <tr>
                <td> </td>
              	<td class="chart-label">UNKNOWN SHARES</td>
              	<td class="chart-data">{{ unknown_shares }}</td>
              </tr>
            </tfoot>
            {% endif %}
        	</table>
        <p><strong>Total Shares: {{ imovel.total_shares }}</strong></p>
        {% if current_user.is_authenticated %}
        <div class="panel-footer">
          <button type="button" class="btn btn-warning btn-xs" data-toggle="modal" data-target="#edit_owners"><span class="glyphicon glyphicon-pencil"></span> Edit</button>
          {% if unknown_shares != imovel.total_shares %}
          <a href="{{ url_for('realestate.delete_owners', imovel_id=imovel.id) }}"><button type="button" class="btn btn-danger btn-xs pull-right"><span class="glyphicon glyphicon-trash"></span> Delete Owners</button></a>
          {% endif %}
        </div>
        {% endif %}
      </div>
      <div class="col-xs-5">
        <canvas id="owners-chart"></canvas>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="panel panel-default">
      <div class="panel-heading text-center panel-headstyle"><h4><strong>Matricula: {{ imovel.matricula_n }}</strong>, {{ moment(imovel.matricula_file_date, local=True).format('LL') }}</h4></div>
      <div class="panel-body">
        {% if imovel.matricula_file %}
        <div class="col-xs-1">
          <img src="{{ url_for('static', filename='pdf.png') }}" class="img-responsive" width=48 height=48>
        </div>
        <div class="col-xs-3">
          <p><strong> {{ moment(imovel.matricula_file_date, local=True).format('LL') }}</strong></p>
          <a href="{{ url_for('main.download_file', filepath=imovel.matricula_file) }}">
      		  <button type="button" class="btn btn-success btn-sm"><span class="glyphicon glyphicon-download-alt"></span> Download</button>
      		</a>
          <button type="button" class="btn btn-info btn-sm" data-toggle="collapse" data-target="#matricula"><span class="glyphicon glyphicon-refresh"></span> Update</button>
        </div>
        <div class="col-xs-8">
    			<div class="collapse" id="matricula">
    				<form method="post" action="" class="form-inline" role="form" enctype="multipart/form-data">
    					<div class = "form-group">
    				    {{ mat_form.csrf_token }}
    				    {{ mat_form.matricula_file.label(class="control-label") }}
    						{{ mat_form.matricula_file(class="form-control") }}
    					</div>
    					<div class ="form-group">
    						{{ mat_form.matricula_file_date.label() }}
    						{{ mat_form.matricula_file_date(class="form-control") }}
    					</div>
    					<div class ="form-group required">
    						{{ mat_form.submit_mat.label(class="sr-only") }}
    						{{ mat_form.submit_mat(class="form-control btn-success") }}
    					</div>
    				</form>
    			</div>
    		</div>
        {% else %}
        <div class="col-xs-3">
          <button type="button" class="btn btn-success" data-toggle="collapse" data-target="#matricula"><span class="glyphicon glyphicon-plus"></span> Add PDF</button>
        </div>
        <div class="col-xs-9">
          <div class="collapse" id="matricula">
    				<form method="post" action="" class="form-inline" role="form" enctype="multipart/form-data">
    					<div class = "form-group">
    				    {{ mat_form.csrf_token }}
    				    {{ mat_form.matricula_file.label(class="control-label") }}
    						{{ mat_form.matricula_file(class="form-control") }}
    					</div>
    					<div class ="form-group">
    						{{ mat_form.matricula_file_date.label() }}
    						{{ mat_form.matricula_file_date(class="form-control") }}
    					</div>
    					<div class ="form-group required">
    						{{ mat_form.submit_mat.label(class="sr-only") }}
    						{{ mat_form.submit_mat(class="form-control btn-success") }}
    					</div>
    				</form>
    			</div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="row">
    <div class="well">
      <p>Last modification: {{ moment(imovel.last_edit_time).fromNow() }}, by: <span class="label label-success">{{ imovel.editor }}</span>
        {% if current_user.is_authenticated %}
        <a href="{{ url_for('realestate.delete_imovel', imovel_id=imovel.id) }}"
          <button type="button" class="btn btn-lg btn-danger pull-right"><span class="glyphicon glyphicon-trash"></span></button>
        </a>
        {% endif %}
      </p>
      <p>Created: {{ moment(imovel.timestamp).format('LLLL') }}, by: <span class="label label-success">{{ imovel.creator }}</span></p>
    </div>
  </div>
</div>

{% include 'realestate/_edit_contact.html' %}

{% include 'realestate/_edit_owners.html' %}

{% else %}
<img src="http://www.quickmeme.com/img/a8/a8022006b463b5ed9be5a62f1bdbac43b4f3dbd5c6b3bb44707fe5f5e26635b0.jpg" class="img-responsive">
{% endif %}
{% endblock %}
